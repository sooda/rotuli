Blogi päivittyi ja siirtyi, jatkossa sooda.fi

Tarpeesta päästä eroon kotiserveristä lähti tämän blogin backendin uudelleenkirjoitus, ja onhan tässä ollut kaikkea pientä suunnitelmissa, niin hyvä pläjäyttää kaikki kerralla voimaan uuden domainnimen myötä.
Sain hiljattain ostettua itselleni sooda.fi:n kuljeksimasta, joka nyt sitten korvaa sooda.dy.fi-osoitteen.
Oli muistaakseni jollain pikkufirmalla joka lakkasi sittemmin olemasta.
Samalla päivittyy ulkoasu, kategorialista muuttuu järkeväksi, sekä vanha djangon päälle koodattu purkka eläköityy ja tilalle tulee rust-harjoituksena tehty staattisten verkkosivujen generaattori/kääntäjä.
Näin ei tarvitse serveripäähän mitään perus-httpd:tä kummempaa.

Tuli jo ainakin `pari vuotta sitten`_ pohdittua blogiin jotain korjauksia, mutta eipä tullut tehtyä.
Nyt kun alkoi olla niin paljon eri syitä, niin tuli ryhdyttyä viimein toimeen, ja tulos on tässä.
Piti aiemminkin jo tutustua rustiin_, ja onhan sen dokumentaatiota ja satunnaisia projekteja tullut luettua vähän on-off-menolla, mutten ollut keksinyt sopivaa harjoitusprojektia.

.. _pari vuotta sitten: /2014/3/10/arkistojen-loytoja-ja-blogauksen-vaikeus/
.. _rustiin: https://www.rust-lang.org/

Blogin uudistus
---------------

Laitoin githubiin sekä saittienginen_ että tämän blogin sisällöt_.
Detskuja voi käydä katsomassa suunnitteludokumentista_, jota en viitsi toistaa tähän. Joitain isoja muutoksia:

.. _saittienginen: http://github.com/sooda/rotulus
.. _sisällöt: http://github.com/sooda/blog
.. _suunnitteludokumentista: http://github.com/sooda/rotulus

* servaus kapsilta_ eikä enää kotoa käsin
* webserver-python/django-projekti muuttui offline-rust-työkaluksi generoimaan kaiken
* kommentit häipyivät
* tagit muuttuivat kategorioiksi eli aihealueiksi; tageja kertyi ihan liikaa. Miksi näitä kutsuu on tosin vain semanttinen ero, mutta joka tapauksessa noiden lukumäärä väheni eikä lisää ole erityisemmin tulossa, koska tagien alla oli yksi tai kaksi tekstiä.
* generointityökalu tukee useampaa kieltä

.. _kapsilta: http://kapsi.fi

Sivujen hostauksen ulkoistaminen auttaa mm. upload-kaistan kurjuuteen kotiserveriltä.
Otaniemessä oli niin erinomainen verkko, ettei aiemmin ollut ongelmaa.
Tuo vanha serveri on tavallinen eläköitynyt PC rumassa kotelossa joka mm. vie tilaa ja kuluttaa sähköä.

Ennen html generoitiin lennossa djangoa_ käyttävällä omakeksimällä webbisoftalla (koodia ei ole nähtävillä, koska muinaista sotkua) ja teksti, kuvien metadata yms. tuli sql-kannasta.
Nyt tietokanta on git-repossa ihan pelkissä tiedostoissa.
Näistä "käännetään" valmis saitti tarvittaessa kun jokin sisältö muuttuu, ja servaamiseen tarvitaan pelkkä http-serveri ilman kummempaa palvelinpään logiikkaa, koska ei sitä logiikkaa aiemminkaan juuri tarvittu.
Näin ollen kaikki huolet mm. skaalautuvuudesta, turvallisuudesta, stabiiliudesta yms. katoavat.

.. _djangoa: https://www.djangoproject.com/

Harkitsin vaihtoehtona tuon djangopurkan porttaamista tuoreimmalle versiolle (koodi on `vuosien takaa`_), mutta hirveä effort, kun lähtökohtakin on kurjaa koodia.
Erityisesti tuommoinen tavallinen blogiengine on niin triviaali softapulikka, ettei siihen oikein saa mitään mielenkiintoista ja motivoivaa.
Uuden ohjelmointikielen opettelu sen sijaan on mukavaa puuhaa.

.. _vuosien takaa: http://sooda.dy.fi/2010/4/16/tein-blogin/

Tekstidata on reStructuredText_-muodossa, kuten aiemminkin (paitsi muokkasin muutamat muinaiset rst:ksi, joissa oli omakeksimä purkka), nyt vain ilman muutamia vanhalle blogienginelle ominaisia templatetageja, jotka helpottivat kirjoittamista mutta sitovat tekstin kyseiseen blogiengineen.
Lisäksi tekstin historia menee kätevästi talteen, koska git.
Samalla lähdetekstin voisi editoida muotoon, jossa olisi vain yksi virke per rivi; näin git-diffeistä tulee helpompilukuisia, jos jotain tekstiä tarvitsee korjata jälkikäteen.
Samaan tyyliin kirjoitin myös mm. dippatyön (LaTeXilla), kun rendattua tulosta ei kiinnosta lähdetekstin (markup) yksittäiset rivinvaihdot - kappalejako merkitään kahdella.
Samaa engineä voipi sitten käyttää ehkä joihinkin muihinkin saitteihin jos tulee tarvis tehdä.
Ainakin yksi on jo mielessä.

Staattisesti servatut sivut eivät tietenkään tue kommentteja sellaisenaan niinkuin vanha järjestelmä, mutta muutaman viestin vuositahdilla tämän kanssa voi elää.
Jos oikeasti tahtoisin kommentoinnin/keskustelumahdollisuuden, niin senhän voisi tunkata jälkikäteen vaikka jollain javaskriptillä (hyi).

Vanhat tagit ovat piilossa, koska tagilistassa ei ollut enää mitään järkeä.
Samat urlit ovat vielä olemassa melkein alkuperäisinä, mutta tagien tilalla on vastaavia juttuja joita kutsun kategorioiksi, koska tagit olivat liian yksityiskohtaisia ja niitä oli liian monta.
Nyt kun tekstejä vieläpä on näin monta, niihin sai keksittyä suunnilleen järkeviä kategorioita, joita en jatkossa lisäile per juttu sitä mukaa kun niiden aiheisiin muka sopisi.

Kirjoitelmia on vuoden 2005 tammikuusta lähtien.
Jo tuolloin naputtelin virityskuvauksia pääasiassa siksi, että saisin omat juttuni itselleni dokumentoitua talteen.
Ei tullut mieleenkään kerätä lukijoita ainakaan Suomen ulkopuolelta, vaan korkeintaan keskustella kavereille tehdyistä hommista.
Oli siis luonnollista blogata suomeksi, ja eihän päiväkirjaa koskaan muutenkaan muita ihmisiä varten pidetä.
Nykyaikainen somevillityskin puuttui, ei ollut youtubea eikä twitteriä, ja facebookikin oli vasta perustettu.
Uusi työkalu tukee useammalla kielellä kirjoittamista ja tekstien erikielisten versioiden linkittämistä toisiinsa, ja aion hiljalleen kääntää näitä englanniksi.

Ulkoasuksi on jo pidempään tullut ajateltua tälläistä no bullshit -mallista yksinkertaisuutta, ja kun vielä nuo per-post päivittyvät asiat eli arkistolista ja kategoriat ovat omilla sivuillaan, saitin generointikin helpottuu.

rotulus
-------

Sen sijaan, että verkkosivuston generoi tietokannasta monimutkaisesti, cachettaa monimutkaisesti ja sitten servaa selaimelle, saitin voi rendata staattisiksi tiedostoiksi, joita sitten tarjotaan sellaisenaan.
Tämä tietty toimii kunnolla vain, jos sivut ovat riittävän yksinkertaiset, eikä serveripäähän tarvita dynaamista logiikkaa.

Selailin wikipediasta ensin erilaisia hämähäkkejä, koska niiden tekemästä verkosta voisi saada sanaleikin sopivalle nimelle työkalulle, joka puljaa interwebsissä.
Päädyin jotenkin kuitenkin pergamentteihin, ja nimeksi tuli tuollainen vanhaa paperia käärössä pitävä rulla, koska se vähän kuin liittyy.

Varmaan oikein hyvä idea olisi ollut käyttää tähänkin blogiin jotain noista kymmenistä tai sadoista valmiista olemassaolevista `staattisen saitin generaattoreista`_ (github pagesin tukema Jekyll olisi esim. aika suosittu, ja Pelican vaikutti myös järjelliseltä).
TODO-listalla on kuitenkin jo vuoden tai pari kutkuttanut rust-ohjelmointikielen_ opettelu, koska vaikuttaa oivalliselta kieleltä.
Githubista löytyikin jo yksi rustilla tehty saittigenis.
Ei kuitenkaan täsmännyt suunnitelmaani, joten tuli sitten jatkettua tekosyyllä opetella rustia.
Syntyi rotulus_, jonka koodi lienee aika sotkua sattuneesta syystä, kunnes opin olemaan.
Toiminee opetteluprojektina itselleni; ehkä siistin tuota ajan kuluessa.

.. _staattisen saitin generaattoreista: https://www.google.com/search?q=static+website+generator
.. _rust-ohjelmointikielen: https://www.rust-lang.org/
.. _rotulus: http://github.com/sooda/rotulus


vielä riittää töitä
-------------------

Jotain hassua poistui, kuten irkkistatsit ja piirtopöytä. TODO pälä pälä

Nuo paste.dy.fi ja fpaste.dy.fi vaativat vielä tuon vanhan serverin djangoineen, eli ihan heti ei voi kärrätä kamaa romuttamolle (lue: otaniemeen jollekin hölmölle).
Lisäksi serverillä pyörii lämpötilaloggeria ja muuta kivaa, jotka varmaan siirrän esim. raspille tms. pikkuserverille, joka ei vie juurikaan tilaa eikä metelöi.
Tykkään tuosta oman pasten lyhyistä tunnisteista jotka melkein muistaa päässä, joten varmaan teen pastebineille jotain säilyttääkseni sen.
Ehkä vaikka porttaan rustiksi tai djangosta johonkin yksinkertaisempaan pythonframeworkkiin jota on kivempi ylläpitää (esim. bottle_).

.. _bottle: http://bottlepy.org
